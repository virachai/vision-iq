  console.log
    Database package: prisma client initialized: true

      at Object.<anonymous> (../../packages/database/src/client.ts:28:9)

FAIL src/image-analysis/gemini-analysis.service.spec.ts
  GeminiAnalysisService
    analyzeImage
      âˆš should successfully analyze an image via Live API with raw text validation (72 ms)
      âˆš should retry if grade validation fails (117 ms)
      âˆš should return result if all retries fail validation (fallback to none) (164 ms)
    gradeRawText
      âˆš should pass Grade A structure (3 ms)
      âˆš should fail if missing sections (2 ms)
      Ã— should fail if enums are invalid (3 ms)
      âˆš should pass with 'easy' level even if some checks fail (1 ms)
      âˆš should bypass validation with 'none' level (2 ms)

  â— GeminiAnalysisService â€º gradeRawText â€º should fail if enums are invalid

    expect(received).toBe(expected) // Object.is equality

    Expected: false
    Received: true

    [0m [90m 297 |[39m [32m`[39m[33m;[39m
     [90m 298 |[39m       [36mconst[39m result [33m=[39m (service [36mas[39m any)[33m.[39mgradeRawText(invalidText)[33m;[39m
    [31m[1m>[22m[39m[90m 299 |[39m       expect(result[33m.[39mpassed)[33m.[39mtoBe([36mfalse[39m)[33m;[39m
     [90m     |[39m                             [31m[1m^[22m[39m
     [90m 300 |[39m       expect(result[33m.[39mfailures)[33m.[39mtoContain(
     [90m 301 |[39m         [32m"Composition or Color Profile enum validation failed"[39m[33m,[39m
     [90m 302 |[39m       )[33m;[39m[0m

      at Object.<anonymous> (src/image-analysis/gemini-analysis.service.spec.ts:299:29)

Test Suites: 1 failed, 1 total
Tests:       1 failed, 7 passed, 8 total
Snapshots:   0 total
Time:        2.154 s, estimated 3 s
Ran all test suites matching /src\\image-analysis\\gemini-analysis.service.spec.ts/i.
